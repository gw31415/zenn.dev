---
title: "ãƒŸãƒ‹ãƒãƒªã‚¹ãƒˆã®ãŸã‚ã®ãƒ•ã‚¡ã‚¸ãƒ¼ã‚»ãƒ¬ã‚¯ã‚¿ fzyselect.vim"
emoji: "ğŸ”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "vim"
  - "neovim"
published: false
published_at: "2022-12-16 19:00"
publication_name: "vim_jp"
---

ã“ã®è¨˜äº‹ã¯[Vim Advent Calender 2022](https://qiita.com/advent-calendar/2022/vim)ã®17æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

![screenshot.png](https://storage.googleapis.com/zenn-user-upload/424e2fab5bb2-20221209.png)

ãƒŸãƒ‹ãƒãƒªã‚¹ãƒˆã®ãŸã‚ã®ãƒ•ã‚¡ã‚¸ãƒ¼ã‚»ãƒ¬ã‚¯ã‚¿ãƒ—ãƒ©ã‚°ã‚¤ãƒ³: [fzyselect.vim](https://github.com/gw31415/fzyselect.vim)ã‚’é–‹ç™ºã—ã¾ã—ãŸã®ã§ã€ãã®ç´¹ä»‹ã‚’ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚

# ãªãœfzyselect.vimãªã®ã‹
ãƒ•ã‚¡ã‚¸ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼ãƒ»ã‚»ãƒ¬ã‚¯ã‚¿ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯Vimãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä¸­ã§ã‚‚è¿‘å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ã«ãªã£ã¦ã„ã¾ã™ã€‚[telescope.nvim](https://github.com/nvim-telescope/telescope.nvim)ã‚„[ddu.vim](https://github.com/Shougo/ddu.vim)ã‚’ã¯ã˜ã‚ã€ä¸–ã®ä¸­ã«ã¯æ§˜ã€…ãªãƒ•ã‚¡ã‚¸ãƒ¼ã‚»ãƒ¬ã‚¯ã‚¿ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒé–‹ç™ºã•ã‚Œã€æ©Ÿèƒ½è¿½åŠ ã•ã‚Œã€å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¸ãƒ¼ã‚»ãƒ¬ã‚¯ã‚¿ã¯ã‚ˆãã§ãã¦ãŠã‚Šã€ãƒ‡ã‚¶ã‚¤ãƒ³ã‚„æ¤œç´¢ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚‚å«ã‚ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æº€è¶³ã•ã›ã¦ãã‚Œã¾ã™ã€‚è§¦ã£ã¦ã„ã‚‹ã ã‘ã§ãƒ¯ã‚¯ãƒ¯ã‚¯ã•ã›ã¦ãã‚Œã‚‹ã‚‚ã®ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã—ã‹ã—ã€ãã‚Œã‚‰ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚½ãƒ¼ã‚¹ãŒå¤šã™ããŸã‚Šã€æŠ½è±¡åº¦ãŒé«˜ã™ãã¦ç”¨ã„ãªã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæº¢ã‚Œã¦ã„ã‚‹ã‚‚ã®ãŒå¤šããªã£ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã¯ã‚ã‚‹ç¨®ã‚¢ã‚¿ãƒªãƒã‚¨ãªå¸°çµã§ã™ã€‚ãƒ•ã‚¡ã‚¸ãƒ¼ã‚»ãƒ¬ã‚¯ã‚¿ã¯æ±ç”¨çš„ãªå­˜åœ¨ã§ã€ãã‚Œã‚’å°å…¥ã™ã‚‹ç›®çš„ã¯ã€Œ**æ§˜ã€…ãªæ“ä½œã«ã¤ã„ã¦ã€çµ±ä¸€çš„ã«æ“ä½œã§ãã‚‹UIã‚’æä¾›ã™ã‚‹**ã€ã“ã¨ã§ã—ã‚‡ã†ã€‚ãªã®ã§ã€ä½™è¨ˆãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ã‚¹ã‚„æ±ç”¨æ€§ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã§æº¢ã‚Œã‚‹ã®ã¯å½“ç„¶ãªã®ã§ã™ã€‚
ã—ã‹ã—ãªãŒã‚‰ãƒŸãƒ‹ãƒãƒªã‚¹ãƒˆã«ã¨ã£ã¦ä½¿ã‚ãªã„ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ã‚¹ã‚„ç”¨ã„ã‚‰ã‚Œãªã„ã‚³ãƒ¼ãƒ‰ã¯æ°—ã«ãªã£ã¦ã—ã¾ã†ã®ãŒæ€§åˆ†ã§ã™ã€‚

ãƒŸãƒ‹ãƒãƒªã‚¹ãƒˆã¯ã€**æ±ç”¨æ€§ã¨åˆç†æ€§ã‚’å…¼ã­å‚™ãˆãŸå¿…è¦æœ€å°é™ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹**ã§å®Ÿè£…ã•ã‚ŒãŸãƒ•ã‚¡ã‚¸ãƒ¼ã‚»ãƒ¬ã‚¯ã‚¿ã‚’æ±‚ã‚ã¦ã„ã‚‹ã®ã§ã™ã€‚fzyselect.vimã‚’é–‹ç™ºã—ãŸã®ã¯ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã§ã™ã€‚

# ç‰¹å¾´
## 1. `vim.ui.select`ã«å¯¾å¿œã™ã‚‹é–¢æ•°ã—ã‹æä¾›ã—ãªã„ã€‚
æœ¬è³ªã¨ã—ã¦æ±ç”¨æ€§ãŒå¿…è¦ã§ã‚ã‚‹ãƒ•ã‚¡ã‚¸ãƒ¼ã‚»ãƒ¬ã‚¯ã‚¿ã‚’ãƒŸãƒ‹ãƒãƒªã‚¹ãƒˆå‘ã‘ã«ã™ã‚‹ãŸã‚ã«ã¯ã€ãã®æ±ç”¨æ€§ã«åˆç†æ€§ãŒã‚ã‚‹ã‚‚ã®ã§ãªãã¦ã¯ãªã‚Šã¾ã›ã‚“ã€‚ã¤ã¾ã‚Šã€**ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œè€…ã®è‡ªä½œä»•æ§˜ã«ã¯ç–‘ã„ã®ä½™åœ°ãŒã‚ã‚‹**ã®ã§ã™ã€‚ã—ãŸãŒã£ã¦ä»Šå›fzyselect.vimã‚’é–‹ç™ºã™ã‚‹ã«ã‚ãŸã‚Šã€ä»•æ§˜ã«ã¤ã„ã¦æ¬¡ã®ã“ã¨ã‚’éµå®ˆã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚
> `vim.ui.select`ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã«åˆã‚ã›ã‚‹

`vim.ui.select`ã¯Neovimã§æ¨™æº–ã¨ã•ã‚Œã¦ã„ã‚‹ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã§ã™ã®ã§ã€ã“ã‚Œã«éµå®ˆã™ã‚‹ã“ã¨ã¯ã‚ªãƒ¬ã‚ªãƒ¬ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è‡ªä½œã™ã‚‹ã‚ˆã‚Šã‚‚åˆç†çš„ã§ã™ã€‚ã“ã‚Œã¯å¤šãã®ãƒŸãƒ‹ãƒãƒªã‚¹ãƒˆã‚’æº€è¶³ã•ã›ã‚‹ã“ã¨ã§ã—ã‚‡ã†ã€‚

## 2. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ã‚¹ã‚’åŒæ¢±ã—ãªã„ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦è¦ã‚‰ãªã„ã‚½ãƒ¼ã‚¹ã¯åŒæ¢±ã™ã‚‹ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ã‚¹ã‚„ã‚­ãƒ¼ãƒãƒƒãƒ—ã¯ä½•ã²ã¨ã¤ã¨ã—ã¦åŒæ¢±ã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚

ã“ã®ãŸã‚ã€å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚½ãƒ¼ã‚¹ã‹ã‚‰è‡ªä½œã™ã‚‹ã“ã¨ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚
ä¾‹ãˆã°ã€`git ls-files`ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚µãƒ¼ãƒã™ã‚‹ã€Œã‚½ãƒ¼ã‚¹ã€ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```vim
fu! s:fzyselect_lsfiles() abort
	let out = system(['git', 'ls-files'])
	if v:shell_error
		echo out
	el
		cal fzyselect#start(split(out, '\n'), #{prompt:'git ls-files'}, {p-><SID>edit(p)})
	en
endfunction
fu! s:edit(path) abort
	if a:path != v:null
		exe 'e ' .. a:path
	en
endfunction
nnoremap <c-p> <cmd>cal <SID>fzyselect_lsfiles()<cr>
```
ãã®ä»–éœ€è¦ãŒé«˜ã„ã¨æ€ã‚ã‚Œã‚‹è¨­å®šã¯[README.md](https://github.com/gw31415/fzyselect.vim/blob/main/README.md#configuration-example)ã«å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

## 3. `matchfuzzypos`ã®ä½¿ç”¨ã€‚
ãƒ•ã‚¡ã‚¸ãƒ¼ãƒãƒƒãƒåŠã³ãƒã‚¤ãƒ©ã‚¤ãƒˆã¯Vimçµ„ã¿ã“ã¿ã®é–¢æ•°:`matchfuzzypos`ã«ã‚ˆã£ã¦è¡Œã„ã¾ã™ã€‚çµ„ã¿ã“ã¿é–¢æ•°ã®ãŸã‚é«˜é€Ÿã§ã€ã‹ã¤è»Šè¼ªã®å†ç™ºæ˜ã¨ãªã£ã¦ã„ãªã„ã“ã¨ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

ç¢ºã‹ã«ãƒ•ã‚¡ã‚¸ãƒ¼ãƒãƒƒãƒã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ãã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ€§èƒ½ã‚’ç‰¹å¾´ã¥ã‘ã‚‹å´é¢ãŒã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—ãªãŒã‚‰ã€ä»Šå›ã¯ã€Œã‚ã‚‹ã‚‚ã®ã¯ä½¿ã†ã€ç²¾ç¥ã§è‡ªå‰å®Ÿè£…ã—ãªã„ã“ã¨ã«ã—ã¾ã—ãŸã€‚

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ãªã©
ã»ã¨ã‚“ã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€è‡ªä½œã‚½ãƒ¼ã‚¹è¨­å®šã®ä»–ã«**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**ã¨**ã‚­ãƒ¼ãƒãƒƒãƒ—è¨­å®š**ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

[Plug.vim](https://github.com/junegunn/vim-plug)
```vim
Plug 'gw31415/fzyselect.vim'
" ä¸­ç•¥
fu! s:fzy_keymap()
	nmap <buffer> i <Plug>(fzyselect-fzy)
	nmap <buffer> <cr> <Plug>(fzyselect-retu)
	nmap <buffer> <esc> <cmd>clo<cr>
endfu
au FileType fzyselect cal <SID>fzy_keymap()
```

[packer.nvim](https://github.com/wbthomason/packer.nvim)
```lua
use {
    'gw31415/fzyselect.vim',
    config = function()
        vim.api.nvim_create_autocmd('FileType', {
            pattern = 'fzyselect',
            callback = function ()
                vim.keymap.set('n', 'i','<Plug>(fzyselect-fzy)', { buffer = true })
                vim.keymap.set('n', '<cr>','<Plug>(fzyselect-retu)', { buffer = true })
                vim.keymap.set('n', '<esc>','<cmd>clo<cr>', { buffer = true })
            end
        })
    end
}
```

# çµã³
å··ã®ãƒ•ã‚¡ã‚¸ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼ã¯æ©Ÿèƒ½ãŒå¤šã™ãã‚‹ã¨ã„ã†æ–¹ã¯ã€æ˜¯é[fzyselect.vim](https://github.com/gw31415/fzyselect.vim)ã‚’ã”åˆ©ç”¨ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
ã”è¦æœ›ã‚„ãƒã‚°å ±å‘ŠãŒã‚ã‚Œã°ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã«ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚
